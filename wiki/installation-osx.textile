h2. Installing Git

We recommend installing the latest version of "MacPorts":http://www.macports.org/. While using the MacPorts at the command line is not difficult, using "Porticus":http://porticus.alittledrop.com/ is far simpler. Once you installed MacPorts be sure to create or edit your *.bash_profile*. This allows you to easily run programs installed by MacPorts. *.bash_profile* is invisible in the Finder because it starts with a period. Use a text editor like Coda or TextWrangler (or a terminal based text editor like Nano, Vim, or Emacs) to create this file if it doesn't exist or simply edit it. The contents should look like the following:

<pre>
PATH=$PATH:/opt/local/bin
export PATH
</pre>

h2. Getting ShiftSpace

Clone the main shiftspace repository into your Sites folder on your machine by typing the following using *Terminal.app*:

<pre class="console">
$ cd ~/Sites
$ git clone git://github.com/ShiftSpace/shiftspace.git
</pre>

Then the run the following to pull in the various git submodules required by shiftspace:

<pre class="console">
$ cd shiftspace
$ git submodule init
$ git submodule update
</pre>

Your clone is now ready to go. 

h2. Installing CouchDB on Intel Mac running 10.5 (Leopard) & 10.6 (Snow Leopard)

We recommend that you install the developer version of CouchDB 0.10 using Jan Lenhardt's prebuilt binaries - CouchDBX. You can find them "here":http://github.com/janl/couchdbx-core/downloads. For 10.5 we recommend "this one":http://cloud.github.com/downloads/janl/couchdbx-core/CouchDBX-0.10.0a-R13B01-pl3-UNSTABLE.zip. For 10.6 we recommend "this one":http://cloud.github.com/downloads/janl/couchdbx-core/CouchDBX-0.10.0a-R13B01-Snow-Leopard-64bit-EXERIMENTAL-RC1.zip.

Drop the CouchDBX application into your *Applications* folder. Double-click on the application to start up CouchDB. Once it's started, point your browser at *http://localhost:5984/_utils/* to make sure that nothing went horribly wrong.

h2. Installing CouchDB on PPC Mac running 10.5 (Leopard)

Use Porticus to install the couchdb-devel package.

h2. Python dependencies

Run the following at the terminal:

<pre class="console">
$ cd ~/Sites/shiftspace/server
$ curl -O http://cloud.github.com/downloads/ShiftSpace/shiftspace/deps.zip
$ unzip deps
$ sudo ./install_deps.sh
</pre>

This installs all of the Python libraries the ShiftSpace backend needs to run. You might notice there is couchdb-lucene .jar as well. We'll get to that in a moment.

h2. Initializing the database

Now we need to initialize the database. Make sure that CouchDBX is running. Type the following into your terminal:

<pre class="console">
$ cd ~/Sites/shiftspace/server
$ python setup.py
</pre>

You should see some output as new documents are added to the databse.

You should point your web browser to *http://localhost:5984/_utils/database.html?shiftspace* to see that the shiftspace database is there and in fact populated with design documents.

h2. Configuring couchdb-lucene

Now that you have CouchDB up and running, you should configure couchdb-lucene. In order for Lucene to index CouchDB and provide full text search capabilities you'll need to edit your CouchDB *local.ini* file. 

h3. If you installed the CouchDBX Application

Right click on the CouchDBX application in your Applications directory using the Finder. You'll get a new window displaying the contents of the application. Drill down through *Contents/Resources/couchdbx-core/couchdb/etc/couchdb/*. Open up *local.ini* in your favorite text editor. Replace the contents with the *local.ini* specified below.

h3. If you installed CouchDB via MacPorts

Open */opt/local/etc/couchdb/local.ini* in your favorite text editor. You will need to enter you admin password in order to edit this file.

h3. local.ini

<pre>
; CouchDB Configuration Settings

; Custom settings should be made in this file. They will override settings
; in default.ini, but unlike changes made to default.ini, this file won't be
; overwritten on server upgrade.

[couchdb]
;max_document_size = 4294967296 ; bytes
os_process_timeout=60000 ; 60 seconds for couchdb-lucene

[httpd]
;port = 5984
;bind_address = 127.0.0.1

[log]
;level = debug                                                                                                      

[update_notification]
; CHANGE THIS LINE, username should be set to your username
indexer=/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home/bin/java -jar /Users/username/Sites/shiftspace/server/couchdb-lucene-0.4-jar-with-dependencies.jar -index
; PPC MACS USE THIS INSTEAD, username should be set to your username
; indexer=/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/bin/java -jar /Users/username/Sites/shiftspace/server/couchdb-lucene-0.4-jar-with-dependencies.jar -index

; To create an admin account uncomment the '[admins]' section below and add a
; line in the format 'username = password'. When you next start CouchDB, it                                        
; will change the password to a hash (so that your passwords don't linger                                                    
; around in plain-text files). You can add more admin accounts with more                                                      
; 'username = password' lines. Don't forget to restart CouchDB after                                                       
; changing this.                                                           
;[admins]                                                                                                               
;admin = mysecretpassword                                                                                                      

[external]
; CHANGE THIS LINE, username should be set to your username
fti=/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home/bin/java -jar /Users/username/Sites/shiftspace/server/couchdb-lucene-0.4-jar-with-dependencies.jar -search
; PPC MACS USE THIS INSTEAD, username should be set to your username
; fti=/System/Library/Frameworks/JavaVM.framework/Versions/1.5.0/Home/bin/java -jar /Users/username/Sites/shiftspace/server/couchdb-lucene-0.4-jar-with-dependencies.jar -search

[httpd_db_handlers]
_fti={couch_httpd_external, handle_external_req, <<"fti">>}
</pre>

*IMPORTANT* You need to change the two lines that call into the couchdb-lucene jar so that the username portion of the path actually matches your own username. If CouchDBX is running shut it down and start it up again to verify there were no errors. 

h3. Fixing PowerPC Mac OS X installs of CouchDB

The issue is explained "here":http://github.com/rnewson/couchdb-lucene/issues#issue/15. Use the Porticus GUI to disable the *jpeg*, *tiff* and *libpng*  packages. Or from the command line type the following:

<pre class="console">
$ sudo port deactivate jpeg tiff libpng
</pre> 

h3. Wrapping up CouchDB configuration

Point your browser at *http://localhost:5984/shiftspace/_fti*. You should see some json output like the following (it doesn't matter if it doesn't completely match).

<pre>
{
    "current": true,
    "disk_size": 1909,
    "doc_count": 4,
    "doc_del_count": 1,
    "fields": [
        "summary",
        "modified",
        "private",
        "draft",
        "createdBy",
        "created",
        "domain",
        "userName",
        "streams",
        "displayName",
        "href"
    ],
    "last_modified": 1252875399000,
    "optimized": false
}
</pre>

h3. Preparing to start the server

In order for the ShiftSpace script to build properly between page refreshes the dependencies between all the JavaScript source files must be determined as well as setting the url. In the future you won't need to set the url since it should just default to *http://localhost:8080*. Until then you have to run the following in a terminal:

<pre class="console">
$ cd ~/Sites/shiftspace/scripts
$ ./setup.sh
</pre>

When prompted, enter *http://localhost:8080*. Take note that there is no trailing slash.

h2. Starting the server

You can now start the ShiftSpace server. Again make sure that the CouchDBX is running. If you installed CouchDB via MacPorts you'll need to start it with the following:

<pre class="console">
$ sudo couchdb
</pre>

You'll be prompted for you admin password.

Let's start the actual ShiftSpace server. Type following into a new terminal:

<pre class="console">
$ cd ~/Sites/shiftspace/server
$ python server.py
</pre>

You should see some output that CherryPy is starting up. In your browser goto *http://localhost:8080/*. Don't forget the trailing slash. You should see a greeting.

Now to really verify that things are working point your browser to to *http://localhost:8080/sandbox/*. Don't miss the trailing slash (we'll fix this later). You should be able to open the ShiftSpace Console by typing the shift key plus the space key together. You should see a *Login* tab. In the login tab there is a *Join* subtab. Select this. Enter your information and click *submit* (sorry the enter key doesn't work yet).

You should now be logged in. Open up the Spaces menu in the lower left. Click on the Notes Space button. You should see an empty note fade onto the page. Type some text and click the save button. You should see your new shift appear in the Console.

Congratulations! You've successfully installed ShiftSpace 1.0. Please refer to the developer manual if you'd like to know more about developing spaces.

h2. Recap

Whenever you want to hack on ShiftSpace, first start up CouchDB. If you have CouchDBX you can just double-click the application. If you installed via MacPorts:

<pre class="console">
$ sudo couchdb
</pre>

Then type the following at a new terminal:

<pre lang="console">
$ cd ~/Sites/shiftspace/server
$ python server.py
</pre>

You can then point your browser to http://localhost:8080/sandbox/, and that's all there is to it.