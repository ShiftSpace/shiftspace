<notextile>

<h1>Tutorial</h1>

<!-- BEGIN GETTING STARTED -->
<h2 id="getting-started">Getting started</h2>

<div class="content">
    <p>This tutorial will guide you through building what is perhaps the simplest space that you can make: HelloWorld. The HelloWorld space, when completed, will allow you to add the words 'Hello World!' as a shift to any page on the web. Potentially, anyone else who has ShiftSpace installed will be able to see your message if they happen to discover it on a page, if they are following your activity, or are part of group that you published the shift to. They can also see without the plugin if they view it in the ShiftSpace proxy. Yet another they way they might see it is if a blog has installed it as a blog plugin.</p>
</div>
<br />

<div class="section">
    <h3 id="before-you-start">Before you start</h3>
    <div class="content">
        <p>But before we begin, make sure you're running <a href="http://mozilla.com">Firefox</a>, that you've <a href="install.html">installed the ShiftSpace development environment</a>, as well as <a href="https://addons.mozilla.org/en-US/firefox/addon/748">GreaseMonkey</a>. You also need to install a cutting edge release of the <a href="http://getfirebug.com/releases/firebug/1.5X/">Firebug extension</a> for Firefox. FireBug is a critical tool for designing your space, it allows you to easily examine and manipulate HTML and CSS "on the fly." It will also prove invaluable for debugging.</p>
        <p>Finally, point your browser at the ShiftSpace Developer Sandbox. This will probably be something like <a target="new" href="http://localhost:8080/sandbox/">http://localhost:8080/sandbox/</a>. You should see a pretty picture of a big desert. This is where most of your development will happen. If you have installed GreaseMonkey and ShiftSpace you should make sure that ShiftSpace never launches on your development URLs, otherwise you'll get some weird results. Right click on the GreaseMonkey icon in the lower right corner of your browser window and select <b>Manage User Scripts...</b>. Select ShiftSpace and click the button <b>Add</b> button next to <b>Excluded Pages</b>. The default value to exclude is correct, just add it. You can now close the GreaseMonkey window and continue hacking.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="using-shifty">Using Shifty</h3>
    <div class="content">
        <p>In your ShiftSpace root directory there is a python script called <b>shifty.py</b>. This is helper tool for running common tasks. In order to use it you have to use the terminal. On OS X this means <b>Terminal.app</b>. If you're on Windows you should have installed <a href="http://code.google.com/p/msysgit/">mysysgit</a>. mysysgit comes packaged with with a bash shell, and we'll refer to this as the terminal. On Linux - well you definitely know what the terminal is ;)</p>
        <p>Open up a terminal and run the following:</p>
        <pre class="console">
$ cd into/your/shiftspace/
$ python shifty.py new HelloWorld</pre>
        <p>This creates all of the files needed for space development in a folder called HelloWorld in the spaces directory where all spaces live. You could have done this by hand, but it's easy to forget exactly what goes in what file. Using shifty.py makes this a whole lot easier. Open the new HelloWorld directory now and examine the contents of the file in your favorite text editor.</p>
        <p>Believe it or not this is a fully functioning space. Let's see it in action.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="installing-a-space">Installing a space</h3>
    <div class="content">
        <p>If you've read over the installation instruction you know that to hack on ShiftSpace you need to start up CouchDB. If you are unsure how to do this refer to last section in the install instructions for your platform.</p>
        <p>You also need to start the built in webserver using Shifty.</p>
        <pre class="console">$ cd into/your/shiftspace/
$ python shifty.py runserver</pre>
        <p>This starts up the server on port 8080. If you want to start up the server on a different port, just give the runserver command a port number that you want to use.</p>
        <p>Now point your browser to the <a target="new" href="http://localhost:8080/sandbox/">sandbox</a>. Open the console with the <b>shift+space</b> key combination. If you haven't created an account do so now (remember this is saving to your local CouchDB). If you have, just login using your username and password.</p>
        <p>Install your space by selecting the <b>Settings</b> tab of the ShiftSpace Console. From there click on the <b>Installed</b> subtab. You should see a list including the pre-installed spaces. Scroll down to the input field. Type in 'HelloWorld' and click the Install button. Careful, space names are case sensitive (we'll fix this in a future version). You should see your space icon appear along with the name underneath the default installed Spaces.</p>
        <p>Click on the <b>Space Menu</b> (first button on the lower left). Select the HelloWorld space. You should see a new orange shift appear on the page. Try dragging it around. Note that when you let go it gets saved and appears in the console.</p>
        <p>Cool. Now let's dig in and see how this works.</p>
    </div>
</div>
<br />
<!-- END GETTING STARTED -->

<!-- START DIVING IN -->
<h2 id="diving-in">Diving In</h2>
<div class="content">
    <p>It's time to see how this stuff works. In the following section we'll dive into what a space looks like as well as how to build one from scratch.</p>
</div>
<br />

<div class="section">
    <h3 id="looking-at-helloworld">Extending the Space Class</h3>
    <div class="content">
        <p>Open HelloWorld.js in the newly created HelloWorld directory. Erase its contents and let's start from scratch.</p>
        <p>At its most basic level, building a new Space involves defining two things:</p>
        <ul>
            <li>The Space class itself (manage the overall UI/behavior for the Space)</li>
            <li>A specific Shift class (manage the UI/behavior of individual shifts)</li>
        </ul>
        <p>To begin, we need extend the ShiftSpace.Space class. This is a very simple operation with MooTools, which offers useful object oriented conventions. By creating subclasses from the ShiftSpace.Space and ShiftSpace.Shift abstract base classes, you gain access to restricted ShiftSpace methods and benefit from our prewritten code. We try to do lot of heavy lifting for you. If you developed a Space prior to 1.0 please note that the subclassing syntax has changed because we are now only supporting MooTools 1.2.</p>
        <pre>
var HelloWorldSpace = new Class({
    Extends: ShiftSpace.Space
    // In a more complicated space you might have stuff here!
});</pre>
        <p>This is using the MooTools subclassing syntax. While nice, we realized this is some serious boilerplate code. You have to write this every time. We got sick of writing it everytime. So here's a shortcut.</p>
        <pre>var HelloWorldSpace = Space();</pre>
        <p>This code is functionally equivalent to previous one but it's a lot less typing. Please not that you cannot use this shortcut generally with MooTools classes, this is a ShiftSpace-specific optimization.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="extending-the-shift-class">Extending the Shift Class</h3>
    <div class="content">
	<p>Now we need to make a HelloWorld Shift class. To do this we need to extend the ShiftSpace.Shift class. Again you could write it like the following:</p>
	<pre>var HelloWorldShift = new Class({
    Extends: ShiftSpace.Shift
    // Your code will go here
});</pre>
	<p>But's simpler and easier to remember to write this:</p>
	<pre>var HelloWorldShift = Shift({
    // Your code will go here
});</pre>
	<p>The first thing you want to implement is the <tt>setup</tt> method.  You should initialize your shift instances based on the properties of the passed in JSON object.</p>
	<pre>var HelloWorldShift = Shift({
    setup: function(json) {
        this.setPosition(json);
        this.makeDraggable();
        this.save();
    }
});</pre>
	<p>We're back to where we were before except that HelloWorld shifts now save themselves as soon as you create them. We haven't done anything new yet, but it's good to drive home how to build a space from scratch.</p>
    </div>
</div>
<br />

<!-- START HOW IT WORKS -->
<h2 id="how-it-works">How it works</h2>
<div class="content">
    <p>You're probably asking yourself how your shift appears on the screen, there's doesn't seem to be any code that does that. To begin to get a idea of how this works we need to look at the attributes file for the HelloWorld space.</p>
</div>
<br />

<div class="section">
    <h3 id="the-space-attributes-files">The space attributes file</h3>
    <div class="content">
	<p>Open the <b>attrs.json</b> file in your HelloWorld space directory and make it look the following:</p>
	<pre>{
    name: 'HelloWorld',
    authors: ['type your name'],
    icon: 'HelloWorld.png',
    css: 'HelloWorld.css',
    description: 'My first space for ShiftSpace 1.0!',
    tooltip: 'The most awesome space evar! or something like that',
    version: 0.1,
    shift: { html: 'HelloWorld.html' }
}</pre>
	<p>This should be pretty self explanatory. ShiftSpace loads this file <i>before</i> it loads your space. That's why you see the space icon, tooltip, description, etc. One thing to note is the <b>shift.html</b> property that we've defined. In the past space developers had to define their interface by writing code. This ended up being a fairly time consuming and tedious affair. Since that time we developed a very useful system called <b>Sandalphon</b> which allows us to design our interfaces using only HTML and CSS. Recently we've made it possible for you to access this functionality without having to be bogged down in the details about how it works.</p>
	<p><b>NOTE FOR PRE-1.0 DEVELOPERS:</b> Prior to 1.0, developers would put their space attributes in the class definition. This is no longer supported and in fact your space will not properly load if you attempt to do this. In order for ShiftSpace to load you must provide a separate attr.json file in your space directory. Why? We want to support a wider variety of Spaces than prior releases did. For example you might want to create a space that always automatically loads on the New York Times. Because the ShiftSpace runtime always loads Spaces lazily (that is, spaces are not loaded until a user actually tries to view, create, or edit a shift) this presents a problem. The only way for ShiftSpace to know about the capabilities of your space before loading it is for you to provide the attrs.json file.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="note-about-conventions">Note about conventions</h3>
    <div class="content">
	<p>Note that in <b>HelloWorld.js</b> the space class is named <b>HelloWorldSpace</b> and the shift class is named <b>HelloWorldShift</b>. This is actually somewhat important. This is a convention. Notice that we did not write it as "HelloWorld_Space". Of course you don't have to follow conventions, but the ShiftSpace runtime cannot read your mind. If you have a different naming convention you would like to use you will need to specify this. If you want to use a different name for your space class specify a <b>className</b> property. For a different shift class name use <b>shift.className</b>.</p>
    </div>
</div>
<br />
<!-- END HOW IT WORKS -->

<!-- START FINISHING TOUCHES -->
<h2 id="finishing-touches">Finishing touches</h2>
<div class="content">
    <p>Hopefully you have a better idea now how the different parts of a space fit together. In this final section we'll look at modifying the CSS as well as adding a couple of new behaviors to your space.</p>
</div>
<br />

<div class="section">
    <h3 id="designing-your-interface-with-html-and-css">Designing your interface with HTML and CSS</h3>
    <div class="content">
	<p>The ShiftSpace teams believe that building extensions for a browser should be "webby." To us this means sticking with HTML+CSS+JavaScript. In the past we leaned a little heavily on JavaScript. Space development now supports designing the look and feel of your interface almost entirely with HTML and CSS. For anything but the most trivial of spaces, this saves hundreds of lines of boilerplate code.</p>
	<p>Basically you provide an html file and we'll add this as property to each shift when it get's created. This might not make much sense right now so let's see how it works.</p>
	<p>Open the file <b>HelloWorld.html</b> and make it look like the following:</p>
	<pre>&lt;div class=&quot;HelloWorldShift&quot;&gt;<br/>    Drag me!<br/>&lt;/div&gt;</pre>
	<p>Now for our CSS file. Open <b>HelloWorld.css</b> and make the font-size a little bit bigger:</p>
	<pre>.HelloWorldShift {
    font: 32px verdana sans-serif;
    position: absolute;
    padding:  5px 10px 5px 10px;
    color: #FFF;
    background-color: #F63B02;
    left:200px;
    top:200px;
}</pre>
    </div>
</div>
<br />

<div class="section">
    <h3 id="check-your-work">Check your work</h3>
    <div class="content">
	<p>Refresh the sandbox, and create a new HelloWorld shift. You should see that your changes have taken.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="understanding-saving">Understanding saving</h3>
    <div class="content">
	<p>You've probably been wondering how HelloWorld can auto-magically save itself to the database. This is because all shifts have an <b>encode</b>. By default shifts encode their position. Instead of using the default <b>encode</b> method, let's provide our own. <b>encode</b> lists every property that you want to persist. Here we want to store a summary (useful because summaries are displayed in the console) and the position of a shift.</p>
	<pre>var HelloWorldShift = Shift({
    setup: function(json) {
        this.setPosition(json.position);
        this.makeDraggable();
        this.save();
    },
  
    encode: function() {
        return {
            summary : this.element.get('text'),
            position : this.getPosition()
        };
    }
}</pre>
	<p>When you call <b>save</b> in your code, ShiftSpace calls your shifts <b>encode</b> method to figure which properties to store in the database.</p>
	<p><b>encode</b> like <b>setup</b> are not methods you call yourself. ShiftSpace will call these methods for you at the proper time. While this approach may seem odd at first, it really frees you up to concern yourself only with the actions and behaviors you would like your space to provide.</p>
	<p>Notice that when saving the <b>summary</b> property, we write <b>this.element</b>. ShiftSpace automatically attaches your interface to your shift instances in the property element. Here were simply using standard MooTools functions to grab the text out of the shift's div.
	<p>Test your space to make sure everything is ok.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="enhancements">Enhancements</h3>
    <div class="content">
	<p>Before moving on let's make it so that you can change the text of the shift by double clicking on it.</p>
	<pre>var HelloWorldShift = Shift({
    setup: function(json) {
        if(json.summary) this.element.set("text", json.summary);
        this.setPosition(json.position);
        this.makeDraggable();
        this.element.addEvent("dblclick", this.changeMessage.bind(this));
        this.save();
    },
  
    changeMessage: function() {
        var text = prompt("Please enter a new message:", this.summary);
        this.element.set("text", text);
        this.save();
    },
  
    encode: function() {
        return {
            summary : this.element.get("text"),
            position : this.getPosition()
        };
    }
});</pre>
	<p>Wow, that made code quite a bit longer. Let's break it apart:</p>
	<pre>if(json.summary) this.element.set("text", json.summary);</pre>
	<p>This means only set the value of our element to the value of json.summary if json.summary has value. For new shifts, summary is null, for HelloWorld shifts that have been saved, this has a definite value.</p>
	<pre>this.element.addEvent("dblick", this.changeMessage.bind(this));</pre>
	<p>This add a double click event handler to our shift. When the event occurs we want to have our <b>changeMessage</b> method called. Because of the peculiarities of JavaScript we have to bind this function to our shift. Event binding while not particularly complex is a conversation outside the scope of this tutorial. We recommend that you read on existing literature on the web on this topic.</p>
	<p>The <b>changeMessage</b> function should be quite clear. It prompts the user for some text, updates the UI, and then saves the shift.</p>
	<p>Finally the <b>encode</b> method set the value of summary to the current value of the text inside the shift's div element.</p>
    </div>
</div>
<br />

<div class="section">
    <h3 id="the-finished-code">The finished code</h3>
    <div class="content">
	<pre>var HelloWorldSpace = Space();
var HelloWorldShift = Shift({
    setup: function(json) {
        if(json.summary) this.element.set("text", json.summary);
	this.setPosition(json.position);
	this.makeDraggable();
	this.element.addEvent("dblick", this.changeMessage.bind(this));
	this.save();
    },
  
    changeMessage: function() {
	var text = prompt("Please enter a new message:", this.summary);
	this.element.set("text", text);
	this.save();
    },

    encode: function() {
        return {
            summary : this.element.get("text"),
            position : this.getPosition()
        };
    }
});</pre>
    </div>
</div>
<br />
<!-- END FINISHING TOUCHES -->

<!-- START WHERE TO GO NEXT -->
<h2 id="where-to-go-next">Where to go next</h2>
<div class="content">
    <p>If you're looking for a deeper look into ShiftSpace you may want to consult the core documentation. You can find it <a target="new" href="docs/">here</a>.</p>
    <p>If you have any questions please feel free to join us our discussion on the ShiftSpace IRC channel. There's almost always at least one or two of the ShiftSpace team members available (as long as you are on US time of course).</p>
    <p>Also feel free to join in the dicussion at either the user email list or the developer email list.</p>
    <p>Happy hacking!</p>
</div>
<!-- END WHERE TO GO NEXT -->

</notextile>
